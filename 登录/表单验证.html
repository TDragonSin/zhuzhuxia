<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <div class="main">
        <form action="" id=register-form>
            <div class="form-item" id="form-item-account" style="border-color: rgb(153, 153, 153);">
                <label>用　户　名</label>
                <input type="text" id="form-account" name="regName" class="field" placeholder="您的账户名和登录名" default="支持中文、英文、数字、“-”、“_”的组合，4-20个字符">
            </div>
            <div class="input-tip" class="error">
            </div>
            <div class="form-item" style="border-color: rgb(153, 153, 153);">
                <label>设 置 密 码</label>
                <input type="password" name="pwd" id="form-pwd" class="field" placeholder="建议使用两种或两种以上字符组合" default="建议使用字母、数字和符号两种及以上的组合，6-20个字符">
            </div>
            <div class="input-tip" class="error">
            </div>
            <div class="form-item" style="border-color: rgb(153, 153, 153);">
                <label>确 认 密 码</label>
                <input type="password" name="pwdRepeat" id="form-equalTopwd" class="field" placeholder="请再次输入密码" default="请再次输入密码">
            </div>
            <div class="input-tip" class="error">
            </div>
            <div class="form-item" style="border-color: rgb(153, 153, 153);">
                <label>邮箱验证</label>
                <input type="text" name="email" id="form-email" class="field" placeholder="请输入邮箱" default="验证完成后，你可以使用该邮箱登录">
            </div>
            <div class="input-tip" class="error">
            </div>

            <button class="btn-register" id="form-register">立即注册</button>
        </form>
    </div>
</body>
<script src="common.js"></script>
<script>
    var necessaryItemObject = {
        userId:{
            el:$("form-account"),
            reg:/^[\u4e00-\u9fa5a-z0-9\-_]{4,20}$/i,
            hasVaild:false
        },
        password:{
            el:$("form-pwd"),
            reg:/^[a-z0-9\u0021-\u002f]{6,20}$/i,
            hasVaild:false
        },
        email:{
            el:$("form-email"),
            reg:/\w{6,20}@[a-z0-9]{2,6}\.[a-z]{2,6}/,
            hasVaild:false
        }
    }

    var form = $("register-form")
    var oInput = form.getElementsByTagName("input")
    form.onclick = delegation(oInput,regMsg)

    function regMsg(){
        this.parentNode.nextElementSibling.innerHTML = this.getAttribute("default")
    }

   //用户名验证
    var userEle = necessaryItemObject.userId.el;
    var userReg = necessaryItemObject.userId.reg;


    userEle.onblur = function(){
        var string = this.value;
        addOnlyState(this,userReg.test(string))
    }



    //密码的验证
    var pwEle = necessaryItemObject.password.el;
    var pwReg = necessaryItemObject.password.reg;

    pwEle.onblur = function(){
        var string = this.value;
        addOnlyState(this,pwReg.test(string))
        strengthValid(this,string);
    }

    //确认密码
    var confirm = $("form-equalTopwd")
    confirm.onblur = function(){
        var string = this.value;
        var label = this.parentNode.childNodes[1]
        this.className = this.className.replace(/\sinput_success|\sinput_error/,"");
        if(this.value == pwEle.value){
            this.parentNode.nextElementSibling.innerHTML = "密码正确"
            this.className += " input_success";
        }else{
            this.parentNode.nextElementSibling.innerHTML = "密码不一致"
            this.className += " input_error";
        }
    }

    //邮箱验证
    var emailEle = necessaryItemObject.email.el;
    var emailReg = necessaryItemObject.email.reg;

    emailEle.onblur = function(){
        var string = this.value;
        addOnlyState(this,emailReg.test(string))
    }


    var btn = $("form-register")
    btn.onclick = function(e){
        var evt = e || window.e
        for(var attr in necessaryItemObject){
            if((!necessaryItemObject[attr].reg.test(necessaryItemObject[attr].el.value))){
                evt.preventDefault();
                break;
            }
        }
        if( confirm.value != pwEle.value){
            evt.preventDefault();
        }
    }



    function addOnlyState(el,bool){
        var label = el.parentNode.childNodes[1]
        el.className = el.className.replace(/\sinput_success|\sinput_error/,"");
        if(bool){
            el.parentNode.nextElementSibling.innerHTML = label.innerHTML+"格式正确"
            el.className += " input_success";
        }else{
            el.parentNode.nextElementSibling.innerHTML = label.innerHTML+"格式错误"
            el.className += " input_error";
        }
    }



    function strengthValid(el,str){
        var strength = 0;
        if(/\d/g.test(str)){
            strength++;
        }
        if(/[a-z]/g.test(str)){
            strength++;
        }
        if(/[\u0021-\u002f]/g.test(str)){
            strength++;
        }

        switch(strength){
            case 1:
                el.style.color = "red";
                break;
            case 2:
                el.style.color = "yellow";
                break;
            case 3:
                el.style.color = "green";
                break;
            default:
                el.style.color = "#fff";

        }

    }

    function $(selector){
        return document.getElementById(selector)
    }
</script>
</html>



